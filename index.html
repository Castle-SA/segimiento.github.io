<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Despachado Table</title>
</head>
<body>
    <h1>Despachado Table</h1>
    <div id="tables"></div>

    <script>
        // URL of the published Google Sheet as CSV
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTmBAXWedGqxYfGaVoGXyCQwBE54QDjnKa5Eel4TTV1-pfqUYYHXrPuww_VBGFMJAqKCD_P9X1nWX_t/pub?output=csv';

        // Example "Numero de Remito" values
        const remitos = ['12345', '67890', '11111'];  // Add more remitos as necessary

        // Function to fetch the CSV data from Google Sheets
        async function fetchCsvData(url) {
            const response = await fetch(url);
            const data = await response.text();
            return data;
        }

        // Function to parse the CSV data into an array of objects
        function parseCsvData(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',');
            const rows = lines.slice(1);
            return rows.map(row => {
                const values = row.split(',');
                return {
                    name: values[0], // File Name
                    id: values[1],   // File ID
                    link: values[2]  // Public Link
                };
            });
        }

        // Function to compare "Numero de Remito" with Google Sheet data
        function compareRemitoWithFiles(remitos, files) {
            const despachadoRows = [];
            remitos.forEach(remito => {
                // Find files whose name starts with the remito number followed by "-Cu"
                const matchedFile = files.find(file => file.name.startsWith(remito + '-Cu'));
                if (matchedFile) {
                    despachadoRows.push({
                        remito: remito,
                        fileLink: matchedFile.link // Store public link to generate public link
                    });
                }
            });
            return despachadoRows;
        }

        // Function to create and display the Despachado table
        function createDespachadoTable(despachadoRows) {
            const section = document.createElement('div');
            section.classList.add('table-section');

            const h2 = document.createElement('h2');
            h2.textContent = 'Despachado';
            section.appendChild(h2);

            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const tbody = document.createElement('tbody');

            // Create table headers
            const headers = ['Numero de Remito', 'Status'];
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);

            // Create table body rows
            despachadoRows.forEach(row => {
                const tr = document.createElement('tr');

                // Create the public link for the Google Drive file
                const fileUrl = row.fileLink;

                const tdRemito = document.createElement('td');
                const aRemito = document.createElement('a');
                aRemito.href = fileUrl;
                aRemito.target = '_blank'; // Open link in a new tab
                aRemito.textContent = row.remito;
                tdRemito.appendChild(aRemito);
                tr.appendChild(tdRemito);

                const tdStatus = document.createElement('td');
                tdStatus.textContent = 'Despachado';
                tr.appendChild(tdStatus);

                tbody.appendChild(tr);
            });

            table.appendChild(thead);
            table.appendChild(tbody);
            section.appendChild(table);

            // Append the table section to the container
            document.getElementById('tables').appendChild(section);
        }

        // Main function to fetch the CSV, parse it, and display the table
        async function init() {
            const csvData = await fetchCsvData(sheetUrl);
            const files = parseCsvData(csvData);
            const despachadoRows = compareRemitoWithFiles(remitos, files);
            createDespachadoTable(despachadoRows);
        }

        // Run the init function on page load
        init();
    </script>
</body>
</html>
